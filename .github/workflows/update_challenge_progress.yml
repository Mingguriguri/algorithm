name: Update Challenge Progress

on:
  pull_request:
    types: [opened, edited, reopened]

jobs:
  update_progress:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: Run extract_pr_data.py
        working-directory: .github/challenge
        run: python extract_pr_data.py

      - name: Run update_scoreboard.py
        working-directory: .github/challenge
        run: python update_scoreboard.py

      - name: Run update_dashboard.py
        working-directory: .github/challenge
        run: python update_dashboard.py

      - name: Commit updated scoreboard.json
        working-directory: .github/challenge
        run: |
          git config --global user.name "${{ secrets.GIT_USER_NAME }}"
          git config --global user.email "${{ secrets.GIT_USER_EMAIL }}"
          git add scoreboard.json DASHBOARD.md HISTORY.md
          git commit -m "Update challenge progress dashboard" || echo "No changes to commit"
          git push origin main

      - name: Post PR Comment with progress
        if: github.event_name == 'pull_request'
        uses: actions/github-script@v6
        with:
          script: |
            const fs = require('fs');
            const dashboard = fs.readFileSync('DASHBOARD.md', 'utf8');
            const prNumber = context.payload.pull_request.number;
            github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: dashboard
            });
